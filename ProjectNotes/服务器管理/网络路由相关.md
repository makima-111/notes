#  一、

## 1、OneSDK打点路由切换

### 问题

* 海外gateway1日志量大，经常报警
* 主要是因为onesdk打点日志量大，两天的未压缩日志就会造成报警
* logrotate运行正常

### 解决过程

#### Jelly前端打点地址

海外 httpsUrl=https://onesdk.cliapi.microfun.com
ipUrls=http://3.120.87.91,http://34.213.255.18

国内 httpsUrl=https://onesdk.cliapi.microfun.cn
ipUrls=http://161.189.164.190

![img](D:\notes\img\{FB57B013-98CF-49FF-05D7-793C2F9C29ED}.png)

#### 观察对应反向代理是否有额外path指向

- [x] monster_cs：无日志指向，指向服务器ip不存在

- [x] /bi/：无日志指向，新服务可兼容

- [x] /mfp_bi/ ：测试url/mfp_bi/500?domain=1&bt=500&from=0&type=6&src=13&idfa=&piex=810*1665&mac=8c83e1b0c080&lang=ko&location=KR&location=20150807JELLYOTHER02&uid=32843106&version=6.1.1&ctime=-2015641735&udid=8478e215539b1d11&openid=&mode=SM-A920N&sys=Android10&platform=18

  正常

- [x] /operctrl/：无此接口

- [x] /mfp_bl/：无流量，可支持

- [x] /

- [ ] /new_bi/dot 不支持



- [x] /ads_service/：映射至本机 不用
- [x] /adjust_pay_test/：映射至本机 不用
- [x] /oper_ant_scheduling/: 无流量 废弃
- [ ] /oper_id_gen/：有流量 502 废弃
- [x] /oper_ant_web_api/：无流量 废弃
- [ ] 

#### onsdk可切换

观察方案：

1. 打开onesdknginxlog 观察流量变化

2. 两个alb的流量变化

   ![image-20210521163143106](D:\notes\img\image-20210521163143106.png)![image-20210521173913733](D:\notes\img\image-20210521173913733.png)

   19w

4. 测试日志发送

## 2、ctrl动态部署

### gateway.oper.microfun.cn

- [ ] /mf-lemoney/    http://172.29.55.108:8001/mf-lemoney/;  
  * 无流量
  * 服务器还在mfop-microfun-page
- [ ]  /mfpctrl/ http://web_ctrl/mfpctrl/;
  * 可正常切换
- [ ] icake/  http://172.29.55.227:8003/icake/
  * 无流量
  * 无服务器
- [ ] /operctrl/  http://web_ctrl/mfpctrl/;
  * 通知大佬切换
  * 有流量
- [ ] /mfpjellyctrl/ http://web_ctrl/mfpctrl/;
  * 通知京杭切换
  * 有流量
- [ ] /mfprc/ http://web_rc/mfprc/;
  * 不可正常切换
  * 服务器还在
  * 无流量
- [ ] /oper/ http://web_ctrl/mfpctrl/;
  * 不可正常切换
  * 有流量
- [ ] /jellyrc/ http://web_rc/mfp_task/;
  * 服务器还在
  * 无流量
- [ ] /urcode/ default_type application/json; return 200 '{"status":2,rewards:"1-2;3-4"}';
- [ ] /login/ default_type application/json; return 200 

### auth.microfun.cn;

- [ ] / http://operwx/share/
  * 
- [ ] /mfpctrl/ http://web_ctrl/mfpctrl/
  * 有流量
  * 认证相关
- [ ] /mfp_toutiao return 200 '{"status":1}'
  * 可切换
- [ ] /gateway/  http://web_ctrl/mfpctrl/
  * 流量小
  * 4条500
- [ ] /mfp_bl/  http://web_dot/mfp_bl/
  * 无流量
- [ ] /jelly_cs/ http://172.29.55.109:8005/jelly_cs/
  * 无服务
- [ ] /bingocrush_cs/ http://astomcat/jelly_cs/
  * 可重定向
  * 有流量
- [ ] /bingocrush_cs_test/ http://172.29.55.171:8003/jelly_cs/
  * 无流量
- [ ] /monster_cs/  http://astomcat/monster_cs/
  * 有流量
  * GET
- [ ] /resources/ /data/cdn/;
  * 有流量
  * GET
- [ ] /monster/ /data/cdn/
  * 有流量
  * GET
- [ ] /bulletin/ /data/cdn
  * 无流量
- [ ] /jelly/ /data/cdn/
  * 无流量
- [ ] /wx/  /data/cdn/
  * 有流量
- [ ] /static/ /data/cdn/bulletin/dist/
  * 无流量
- [ ] /mr1/ http://operwx/share/v1/monster/transitionDelay/1/
- [ ] /mt/ http://operwx/share/v1/monster/tencentGdt/
- [ ] /bingo/ http://operwx/share/v1/transitionDelayBD/bingobaiduluodiye
- [ ] /bingobd/ http://operwx/share/v1/transitionDelayR1/bingobaiduluodiye
- [ ] /bgd/ http://operwx/share/v1/bingoBaidu/
- [ ] 

