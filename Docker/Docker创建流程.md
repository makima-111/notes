## 一、Docker创建流程

### 1、编写Dockerfile文件

* 编写文件并配置相关文件到指定目录

### 2、启动docker

```shell
systemctl start docker
```

### 3、创建镜像

* 命令行运行命令创建镜像

```bash
sudo docker build -t [todir] [fromdir]
```

### 4、创建容器

* Run

docker run --name ads_servic --hostname=ads_servic --privileged=true --sysctl net.ipv6.conf.all.disable_ipv6=1  -v /sys/fs/cgroup:/sys/fs/cgroup:ro -p 13001:3000 -d 329131629594.dkr.ecr.us-west-2.amazonaws.com/prod/oper/ads_service:latest



## 二、常用命令

### 1、容器相关

#### 创建容器 run

```shell
#创建容器
docker run
```

* -p 设置端口号映射 -p  主机端口:容器端口

#### 查看容器状态 ps

```shell
docker ps -a
```

#### 停止容器 stop

```shell
#停止容器
docker stop CONTAINER_ID
```

#### 删除容器 rm

```shell
#删除容器
docker
```

#### 进入容器 exec

```bash
docker exec -it ads_servic bash
```

### 查看系统日志 **journalctl**

```shell
journalctl -f #实时日志
```







# 三、常见问题

### 1、docker ping不通外网(报错)  

#### 1）DNS配置问题

* 将docker内的/etc/resolv.conf 文件修改到与主机对应文件一致

```bash
#AWS 服务器
vi /etc/resolv.conf
修改为
; generated by /usr/sbin/dhclient-script
search us-west-2.compute.internal
nameserver 172.26.0.2

#生产环境
#docker
options ndots:0
nameserver 202.106.0.20
nameserver 114.114.114.114
#service
; generated by /usr/sbin/dhclient-script
search cn-northwest-1.compute.internal
nameserver 172.29.52.2

```

#### 2）重启docker

```shell
systemctl restart docker 
```



### 2、容器内无法启动systemctl

#### 1）权限问题

```bash
run 容器时传入   --privileged=true
```

#### 2）.Service 文件启动失败

```bash
#正确写法为
/usr/local/bin/npm run start
```

* 命令的绝对地址采用type [命令] 查看

### 3、

